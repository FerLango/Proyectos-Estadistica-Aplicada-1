---
title: "Víctimas en carpetas de investigación FGJ"
subtitle: "Estadística Aplicada 1 - Proyecto 1"
author: "Fernando Lango - 181055"
email: "flangoba@itam.mx"
date: "`r format(Sys.time(), '%d/%m/%Y')`"
name: "Proyecto 1"
toc-title: Contenido  
indent: True
#bibliography: citations.bib
#csl: apa.csl 
#nocite: '@*'
#link-citations: True
output: 
  prettydoc::html_pretty:
    theme: cayman
    toc: True
    highlight: github
    number_sections: True
    fig_caption: True
    #pandoc_args: [ "--output=index.html"]
    #includes:
      #in_header: "Icono/icono.html"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introducción

Insertar intro de lo que se va a hacer.

## Ambiente de R

Para el análisis de los datos se utilizaron las librerías que se muestran a continuación:

- `tidyverse` -> carga de archivos csv, creación de gráficas y manipulación de tablas.
- `lubridate` -> manejo de fechas.
- `openxlsx` -> carga de archivos de excel.
- `kableExtra` -> diseño de tablas.

```{r, message=FALSE, warning=FALSE}
library(plotly)
library(tidyverse)
library(lubridate)
library(openxlsx)
library(kableExtra)
library(sf)
```

## Conjunto de datos

Los conjuntos de datos utilizados en el presente análisis se pueden descargar en [Víctimas en carpetas de investigación](https://archivo.datos.cdmx.gob.mx/fiscalia-general-de-justicia/victimas-en-carpetas-de-investigacion-fgj/victimas_completa_julio_2021.csv) y [Diccionario de víctimas](https://datos.cdmx.gob.mx/dataset/7593b324-6010-44f7-8132-cb8b2276c842/resource/10235569-f4a9-4876-9465-9780887df8e2/download/diccionario-de-victimas-actualizado.xlsx) dentro del [Portal de Datos Abiertos de la CDMX](https://datos.cdmx.gob.mx/). Para mayor información del conjunto de datos se puede consultar en [Víctimas en carpetas de investigación FGJ](https://datos.cdmx.gob.mx/dataset/victimas-en-carpetas-de-investigacion-fgj).

La base contiene la información de las víctimas de diversos delitos que cuentan con una carpeta de investigación en la [Fiscalía General de Justicia (FGJ) de la Ciudad de México](https://www.fgjcdmx.gob.mx/) a partir de enero del año 2019.

### Descarga

```{r, cache=TRUE, message=FALSE}
data_url <- "https://archivo.datos.cdmx.gob.mx/fiscalia-general-de-justicia/victimas-en-carpetas-de-investigacion-fgj/victimas_completa_julio_2021.csv"

victimas <- read_csv(data_url, show_col_types = FALSE)

dicc_url <- "https://datos.cdmx.gob.mx/dataset/7593b324-6010-44f7-8132-cb8b2276c842/resource/10235569-f4a9-4876-9465-9780887df8e2/download/diccionario-de-victimas-actualizado.xlsx"

diccionario <- read.xlsx(dicc_url, sheet =1)
```

### Formato de columnas

```{r}
victimas$Mes_inicio <- as.factor(victimas$Mes_inicio)
victimas$FechaInicio <- dmy(victimas$FechaInicio)
victimas$Delito <- as.factor(victimas$Delito)
victimas$Categoria <- as.factor(victimas$Categoria)
victimas$Sexo <- as.factor(victimas$Sexo)
victimas$TipoPersona <- as.factor(victimas$TipoPersona)
victimas$CalidadJuridica <- as.factor(victimas$CalidadJuridica)
victimas$competencia <- as.factor(victimas$competencia)
victimas$Mes_hecho <- as.factor(victimas$Mes_hecho)
victimas$FechaHecho <- dmy(victimas$FechaHecho)
victimas$AlcaldiaHechos <- as.factor(victimas$AlcaldiaHechos)
```

### Descripción de las variables

```{r}
diccionario[,1:2] %>%
  kable()
```

# Análisis exploratorio

## Estadísticos



## Gráficas

```{r, warning=FALSE, cache=FALSE, message=FALSE}
if (!file.exists("datos_mapa.zip")) {
  map_url <- "https://github.com/prestevez/covid-19-mx-map/raw/master/datos_covid/01_32_mun.zip"
  download.file(map_url, destfile = "datos_mapa.zip")
  unzip("datos_mapa.zip", exdir = "datos_mapa")
  file.remove("datos_mapa.zip")
}

mex_map <- 
  st_read("datos_mapa/01_32_mun.shp") %>% 
  st_set_crs("+proj=lcc +lat_1=17.5 +lat_2=29.5 +lat_0=12 +lon_0=-102 +x_0=2500000 +y_0=0 +ellps=GRS80 +units=m +no_defs") %>%
  filter(CVE_ENT == "09") %>%
  rename(Alcaldia = NOMGEO)


mex_map$Alcaldia <- chartr("ÁÉÍÓÚ", "AEIOU", 
                         toupper(mex_map$Alcaldia))

map_filt <- 
  victimas %>% 
  select(AlcaldiaHechos) %>%
  group_by(AlcaldiaHechos) %>%
  tally(name = "Delitos") %>%
  na.omit()

map_filt$AlcaldiaHechos <- 
  str_replace(map_filt$AlcaldiaHechos,
              "GUSTAVO A MADERO", "GUSTAVO A. MADERO")


mex_map_del <- 
  left_join(mex_map, map_filt, 
            by = c("Alcaldia" = "AlcaldiaHechos"))

map <- 
  ggplot() +
  geom_sf(data = mex_map_del, 
          aes(fill = Delitos, shape = Alcaldia),
          colour = "grey75", size = 0.1) +
  labs(title = "Cantidad de delitos por alcaldía") +
  theme_bw() + 
  scale_fill_gradient("Total de delitos", 
                      high = "red", low = "yellow") +
  theme(legend.position = "none")

ggplotly(map, tooltip = c("Delitos","Alcaldia"))

```


# Referencias


























