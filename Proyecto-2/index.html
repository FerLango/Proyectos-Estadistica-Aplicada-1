<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Fernando Lango - 181055" />


<title>Encuestas censuradas</title>

<script src="encuestas_files/header-attrs-2.11/header-attrs.js"></script>
<link rel="shortcut icon" href="icono.ico">


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

/* A workaround for https://github.com/jgm/pandoc/issues/4278 */
a.sourceLine {
  pointer-events: auto;
}

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link rel="stylesheet" href="encuestas_files/style.css" type="text/css" />





</head>

<body>




<header>
<div class="inner">
<h1 class="title toc-ignore">Encuestas censuradas</h1>
<h2 class="subtitle">Estadística Aplicada 1 - Proyecto 2</h2>
<h3 class="author">Fernando Lango - 181055</h3>
<h3 class="date">14/10/2021</h3>
</div>
</header>


<div id="TOC" class="toc">
<div class="inner">
<h2 id="toc-title" class="toc-title">Contenido</h2>
<ul>
<li><a href="#planteamiento-del-problema"><span class="toc-section-number">1</span> Planteamiento del problema</a>
<ul>
<li><a href="#problema"><span class="toc-section-number">1.1</span> Problema</a></li>
<li><a href="#descripción"><span class="toc-section-number">1.2</span> Descripción</a></li>
<li><a href="#proyecto"><span class="toc-section-number">1.3</span> Proyecto</a></li>
</ul></li>
<li><a href="#solución"><span class="toc-section-number">2</span> Solución</a>
<ul>
<li><a href="#tiempo-de-sobrevida"><span class="toc-section-number">2.1</span> Tiempo de sobrevida</a>
<ul>
<li><a href="#sesgo"><span class="toc-section-number">2.1.1</span> Sesgo</a></li>
<li><a href="#varianza"><span class="toc-section-number">2.1.2</span> Varianza</a></li>
<li><a href="#error-cuadrático-medio-mse"><span class="toc-section-number">2.1.3</span> Error cuadrático medio (MSE)</a></li>
<li><a href="#consistencia"><span class="toc-section-number">2.1.4</span> Consistencia</a></li>
</ul></li>
<li><a href="#función-de-supervivencia-empírica"><span class="toc-section-number">2.2</span> Función de supervivencia empírica</a>
<ul>
<li><a href="#consistencia-1"><span class="toc-section-number">2.2.1</span> Consistencia</a></li>
<li><a href="#sesgo-1"><span class="toc-section-number">2.2.2</span> Sesgo</a></li>
<li><a href="#varianza-1"><span class="toc-section-number">2.2.3</span> Varianza</a></li>
</ul></li>
<li><a href="#media-de-la-función-de-supervivencia"><span class="toc-section-number">2.3</span> Media de la función de supervivencia</a></li>
</ul></li>
<li><a href="#análisis-gráfico-y-simulaciones"><span class="toc-section-number">3</span> Análisis gráfico y simulaciones</a>
<ul>
<li><a href="#ambiente-de-r"><span class="toc-section-number">3.1</span> Ambiente de R</a></li>
<li><a href="#población"><span class="toc-section-number">3.2</span> Población</a>
<ul>
<li><a href="#registro-completo"><span class="toc-section-number">3.2.1</span> Registro completo</a></li>
<li><a href="#toda-la-población"><span class="toc-section-number">3.2.2</span> Toda la población</a></li>
</ul></li>
<li><a href="#muestra"><span class="toc-section-number">3.3</span> Muestra</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="content-wrapper">
  <div class="inner clearfix">
    <section id="main-content">
<div id="planteamiento-del-problema" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Planteamiento del problema</h1>
<div id="problema" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Problema</h2>
<p>Interesa cuantificar el tiempo de sobreviva de un paciente a partir de su diagnóstico con una enfermedad. Se sabe que dicha enfermedad reduce el tiempo de vida de las personas (respecto a la media de los no enfermos) e interesa determinar cuánto tiempo vivirá después de su diagnóstico. Finalmente suponemos que todas las personas eventualmente mueren (independientemente de la causa).</p>
</div>
<div id="descripción" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Descripción</h2>
<p>Considera una población finita de pacientes <span class="math inline">\(x_{i}\)</span> los cuales tienen asociados su tiempo de sobrevida (<span class="math inline">\(i.e.\)</span> cuánto tiempo tardan en fallecer a partir del momento de diagnóstico)</p>
<p><span class="math display">\[
U = \{(x_{1}, t_{1}),(x_{2}, t_{2}),...,(x_{N}, t_{N})\}
\]</span></p>
<p>De esta población se obtiene una muestra aleatoria <span class="math inline">\(S\)</span> mediante muestreo simple con <span class="math inline">\(\pi_{k} = \mathbb{P}((x_{k},t_{k}) \in S)\)</span>. Estas personas son los recién diagnosticados. Cada día se les llama a los cuidadores de los pacientes para ver cómo han evolucionado en su enfermedad. En el caso de que se reporte que el paciente <span class="math inline">\(i\)</span> haya fallecido se registra <span class="math inline">\(t_{i} = \tau_{i}\)</span> el día en el que falleció (medido a partir del tiempo <span class="math inline">\(t_{0}\)</span> de diagnóstico). Por ejemplo, si un paciente fue diagnosticado hace veinte días y en la llamada de hoy nos dicen que murió, entonces su <span class="math inline">\(t_{i}\)</span> es <span class="math inline">\(20\)</span>. En teoría obtendríamos la muestra conjunta de los pacientes y el tiempo que tardaron en fallecer.</p>
<p><span class="math display">\[
S = \{(x_{1}, t_{1}),(x_{2}, t_{2}),...,(x_{n}, t_{n})\}
\]</span></p>
<p>donde un ejemplo sería <span class="math inline">\(x_{i} = \text Fer\)</span> y <span class="math inline">\(t_{i} = 10\)</span> si el paciente <em>Fer</em> se murió a los <span class="math inline">\(10\)</span> días de su diagnóstico.</p>
<p>En particular, cada día los cuidadores tienen una probabilidad <span class="math inline">\(p \in [0,1)\)</span> (constante desconocida) de dejar de contestar el teléfono para siempre incluso antes de que el paciente muera por lo que para <span class="math inline">\(n - \ell\)</span> pacientes no se registra el momento en el que murieron, sino el último momento en el que se supo que estaban vivos antes de que el cuidador dejara de contestar el teléfono. En este escenario representamos la muestra como:</p>
<p><span class="math display">\[
S = \{(x_{1}, t_{1}),(x_{2}, t_{2}),...,(x_{\ell}, t_{\ell}), (x_{\ell+1}, \nu_{\ell+1}), (x_{\ell+2}, \nu_{\ell+2}), ... , (x_{n}, \nu_{n}) \}
\]</span></p>
<p>donde <span class="math inline">\(\nu_{j}\)</span> representa el último momento en el que se contactó al cuidador del paciente (y se sabe que <span class="math inline">\(t_{j} &gt; \nu_{j}\)</span>).</p>
<ol style="list-style-type: decimal">
<li><p>Una opción para estimar el tiempo de sobrevida de los pacientes (definido como <span class="math inline">\(\mu = \frac{1}{N}\sum\limits_{i=1}^{N} t_{i}\)</span>) es quitar a los que se les perdió en el seguimiento y estimar la media sólo con los que sí se registraron completos: <span class="math display">\[
\hat{\mu} = \frac{1}{n}\sum_{i=1}^{\ell} t_{i}
\]</span> (recordemos que <span class="math inline">\(\ell\)</span> es aleatorio pues depende de <span class="math inline">\(p\)</span>). Determina su error cuadrático medio, sesgo y varianza, así como su consistencia. Recordemos que van a depender de <span class="math inline">\(p\)</span> y no de <span class="math inline">\(\ell\)</span>.</p></li>
<li><p>Se construye la función de supervivencia empírica dada por: <span class="math display">\[
S_{n}(t) = 1 - F_{n}(t)
\]</span> donde <span class="math display">\[
F_{n}(t) = \frac{1}{n}\sum_{i=1}^{n} \mathbb{I}_{[\tau_{i},\infty)}(t)
\]</span> con <span class="math inline">\(\tau_{i} = {t_i}\)</span> ó <span class="math inline">\(\tau_{i} = \nu_{i}\)</span> según el que se haya medido. Verificar la consistencia (Fisher), sesgo y varianza de <span class="math inline">\(S_{n}(t)\)</span>.</p></li>
<li><p>Finalmente, utilizar que a partir de la función <span class="math inline">\(S_{n}(t)\)</span> se puede calcular la media (recordar que hay formas de usar la distribución acumulada para calcular la media sin derivar porque esto no se puede derivar en todo su dominio y en donde sí es cero) para construir un estimador de <span class="math inline">\(\mu\)</span>.</p></li>
</ol>
</div>
<div id="proyecto" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Proyecto</h2>
<p>Construir los estimadores para <span class="math inline">\(\mu\)</span> y determina cuál es el mejor usando como criterios: funciones de pérdida, varianza, consistencia (de Fisher), sesgo ya sea de manera directa o mediante experimentos numéricos. Genera sus intervalos de confianza (bootstrap). Finalmente, construye una función de R para realizar la estimación. La base de datos que se le pasaría sería así donde no haya dato en <code>Tiempo de fallecimiento</code> significa que se perdió durante el seguimiento.</p>
<table>
<thead>
<tr class="header">
<th align="center">Persona</th>
<th align="center">Tiempo de fallecimiento (días)</th>
<th align="center">Último tiempo registrado</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">20</td>
<td align="center">20</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">12</td>
<td align="center">12</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center"></td>
<td align="center">87</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">30</td>
<td align="center">30</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">100</td>
<td align="center">100</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center"></td>
<td align="center">20</td>
</tr>
<tr class="odd">
<td align="center">7</td>
<td align="center"></td>
<td align="center">8</td>
</tr>
<tr class="even">
<td align="center">8</td>
<td align="center">15</td>
<td align="center">15</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="solución" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Solución</h1>
<div id="tiempo-de-sobrevida" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Tiempo de sobrevida</h2>
<p>Cuando tomamos una muestra de la población, esta es de tal manera que incluye a aquellas personas que dejaron de contestar pero en realidad no tenemos conocimiento si se encuentran vivos:</p>
<p><span class="math display">\[
S = \{(x_{1}, t_{1}),(x_{2}, t_{2}),...,(x_{\ell}, t_{\ell}), (x_{\ell+1}, \nu_{\ell+1}), (x_{\ell+2}, \nu_{\ell+2}), ... , (x_{n}, \nu_{n}) \}
\]</span></p>
<p>El tiempo de sobrevida de los pacientes está definido como sigue:</p>
<p><span class="math display">\[
\mu = \frac{1}{N}\sum\limits_{i=1}^{N} t_{i}
\]</span></p>
<p>Si estimamos el tiempo de sobrevida de los pacientes tomando solamente en cuenta a aquellos de los que se tiene el registro completo, entonces podemos definir el estimador de la siguiente manera:</p>
<p><span class="math display">\[
\hat{\mu} = \frac{1}{n}\sum_{i=1}^{\ell} t_{i}
\]</span></p>
<p>Notemos que el límite superior de la suma llega hasta <span class="math inline">\(\ell\)</span> (aleatorio) que nos indica la cantidad de personas de las que estamos seguros que fallecieron.</p>
<p>Recordemos que cada día los cuidadores tienen una probabilidad <span class="math inline">\(p \in [0,1)\)</span> de dejar de contestar el teléfono, por lo que la cantidad de pacientes de los que se va a tener la información completa se distribuye <em>Binomial</em> y depende de <span class="math inline">\(p\)</span>.</p>
<div id="sesgo" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Sesgo</h3>
<p>Recordemos que el sesgo de <span class="math inline">\(\hat{\mu}\)</span> está definido como:</p>
<p><span class="math display">\[
\begin{split}
\text{Sesgo}_{\mu} 
    &amp; = \mathbf{E}(\hat{\mu}) - \mu \\
    &amp; = \mathbf{E}(\frac{1}{n}\sum_{i=1}^{\ell} t_{i}) - \mu \\
    &amp; = \frac{1}{n} \sum_{i=1}^{\ell} \mathbf{E}(t_{i}) - \mu \\
    &amp; = \frac{1}{n} \sum_{i=1}^{\ell} \mu - \mu \\
    &amp; = \frac{1}{n}\ell\mu - \mu \\
    &amp; = \frac{\ell}{n}\mu - \mu \\
    &amp; = \mu(\frac{\ell}{n}-1)
\end{split}
\]</span></p>
<p>Por lo tanto, podemos determinar que el estimador <span class="math inline">\(\hat{\mu}\)</span> es insesgado si y solo si <span class="math inline">\(p=0\)</span> (es decir, los cuidadores en ningún momento dejaron de contestar). De esta manera, el <span class="math inline">\(\text{Sesgo}_{\mu}\)</span> depende de <span class="math inline">\(p\)</span> con <span class="math inline">\(\ell \backsim \text{Binom}(n,p)\)</span>.</p>
</div>
<div id="varianza" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Varianza</h3>
<p>Para determinar la varianza de <span class="math inline">\(\hat{\mu}\)</span> utilizamos la siguiente formula y supondremos independencia sobre el tiempo de sobrevida:</p>
<p><span class="math display">\[
\begin{split}
\text{Var}({\hat{\mu}}) 
    &amp; = \text{Var}(\frac{1}{n}\sum_{i=1}^{\ell} t_{i}) \\
    &amp; = \frac{1}{n^2}\text{Var}(\sum_{i=1}^{\ell} t_{i}) \\
    &amp; = \frac{1}{n^2}(\sum_{i=1}^{\ell} \text{Var}(t_{i}) + 
        \sum_{i=1}^{\ell} \sum\limits_{\substack{j=1 \\ j\ne i}}^{\ell}
        \text{Cov}(t_{i}, t_{j})) \\
    &amp; = \frac{1}{n^2}(\ell\sigma^2 +  \sum_{i=1}^{\ell}                               \sum\limits_{\substack{j=1 \\ j\ne i}}^{\ell}
        (\pi_{i,j}-\pi_{i}\pi_{j})) \\
     &amp; = \frac{1}{n^2}(\ell\sigma^2 +  \sum_{i=1}^{\ell}                               \sum\limits_{\substack{j=1 \\ j\ne i}}^{\ell}\Delta_{i,j})
\end{split}
\]</span></p>
</div>
<div id="error-cuadrático-medio-mse" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> Error cuadrático medio (MSE)</h3>
<p>Recordemos que el error cuadrático medio está definido como sigue:</p>
<p><span class="math display">\[
\begin{split}
\text{MSE}(\hat{\mu},\mu) 
    &amp; = \mathbf{E}[(\hat{\mu}-\mu)^2] \\
    &amp; = \text{Var}(\hat{\mu}) + (\text{Sesgo}_{\mu}(\hat{\mu}))^2 \\
    &amp; = \frac{1}{n^2}(\ell\sigma^2 +  \sum_{i=1}^{\ell}                               \sum\limits_{\substack{j=1 \\ j\ne i}}^{\ell}\Delta_{i,j}) +
        (\mu(\frac{\ell}{n}-1))^2
\end{split}
\]</span></p>
</div>
<div id="consistencia" class="section level3" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> Consistencia</h3>
<p>Veamos si el estimado es Fisher-consistente:</p>
<p><span class="math display">\[
\begin{split}
\lim_{n \rightarrow N} \hat{\mu} 
    &amp; = \lim_{n \rightarrow N} \frac{1}{n}\sum_{i=1}^{\ell} t_{i} \\
    &amp; = \frac{1}{N}\sum_{i=1}^{\ell} t_{i} \ne 
        \frac{1}{N}\sum_{i=1}^{N} t_{i}
\end{split}
\]</span></p>
<p>Por lo tanto, no es Fisher-consistente, pues depende nuevamente de la probabilidad de que el cuidador conteste. Al solamente tomar en cuenta aquellos que sí contestaron, tenemos un sesgo que se refleja al llevar el estimador al límite porque no estamos llegando al valor verdadero de toda la muestra.</p>
</div>
</div>
<div id="función-de-supervivencia-empírica" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Función de supervivencia empírica</h2>
<p>Mediante la función de supervivencia empírica buscamos estimar a la verdadera función de supervivencia. De esta manera podremos estimar el tiempo de sobrevida de los pacientes.</p>
<p>La función de supervivencia empírica está dada por:</p>
<p><span class="math display">\[
S_{n}(t) = 1 - F_{n}(t)
\]</span> donde <span class="math display">\[
F_{n}(t) = \frac{1}{n}\sum_{i=1}^{n} \mathbb{I}_{[\tau_{i},\infty)}(t)
\]</span> con <span class="math inline">\(\tau_{i} = {t_i}\)</span> ó <span class="math inline">\(\tau_{i} = \nu_{i}\)</span>.</p>
<p>Podemos interpretar la función de supervivencia empírica como el complemento de un función de acumulación. De esta manera, la función de supervivencia será decreciente a lo largo de la edad que se registró que vivieron los pacientes. Además, podemos observar que cumple las siguientes propiedades:</p>
<ul>
<li><span class="math inline">\(S_{n}(\nu_{1}) \approx 1\)</span></li>
<li><span class="math inline">\(S_{n}(\nu_{n}) \approx 0\)</span></li>
</ul>
<div id="consistencia-1" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Consistencia</h3>
<p>Resulta sencillo observar que la función de supervivencia empírica es Fisher-consistente, pues:</p>
<p><span class="math display">\[
\begin{split}
\lim_{n \rightarrow N} S_{n}(t) 
    &amp; = \lim_{n \rightarrow N} 1 - F_{n}(t) \\
    &amp; = \lim_{n \rightarrow N} 1 - 
        \frac{1}{n}\sum_{i=1}^{n} 
        \mathbb{I}_{[\tau_{i},\infty)}(t) \\
    &amp; = 1 - \frac{1}{N}\sum_{i=1}^{N} 
        \mathbb{I}_{[\tau_{i},\infty)}(t) \\
    &amp; = 1 - F_{N}(t) \\
    &amp; = S_{N}(t) 
\end{split}
\]</span></p>
<p>De esta manera, en realidad estamos obteniendo la función de supervivencia empírica de toda la población.</p>
</div>
<div id="sesgo-1" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Sesgo</h3>
<p>Dado nuestro estimador <span class="math inline">\(S_{n}(t)\)</span> de <span class="math inline">\(S_{N}(t)\)</span>, definimos el sesgo como:</p>
<p><span class="math display">\[
\begin{split}
\text{Sesgo}_{\hat{S_{n}}(t)}(S_{n}(t)) 
    &amp; = \mathbf{E}(\hat{S_{n}}(t)) - S_{n}(t) \\
    &amp; = \mathbf{E}(1 - \hat{F_{n}}(t)) - S_{n}(t) \\
    &amp; = \mathbf{E}[1 - 
        \frac{1}{n}\sum_{i=1}^{n} 
        \mathbb{I}_{[\tau_{i},\infty)}(t)] - S_{n}(t)\\
    &amp; = 1 - \frac{1}{n}\sum_{i=1}^{n}\mathbf{E}[
        \mathbb{I}_{[\tau_{i},\infty)}(t)] - S_{n}(t)\\
    &amp; = 1 - \frac{1}{n}\sum_{i=1}^{n}\pi_{i} - S_{n}(t)\\
    &amp; = 1- \frac{1}{n}nF_{n}(t) - S_{n}(t)\\
    &amp; = 1- F_{n}(t) - S_{n}(t)\\
    &amp; = S_{n}(t) - S_{n}(t)\\
    &amp; = 0
\end{split}
\]</span></p>
<p>De esta manera podemos concluir que el estimador de la función de supervivencia empírica es insesgado.</p>
</div>
<div id="varianza-1" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Varianza</h3>
<p>Definimos la varianza de la siguiente manera:</p>
<p><span class="math display">\[
\begin{split}
\text{Var}(S_{n}(t)) 
    &amp; = \text{Var}(1-F_{n}(t)) \\
    &amp; = \text{Var}(1-\frac{1}{n}\sum_{i=1}^{n} 
        \mathbb{I}_{[\tau_{i},\infty)}(t)) \\
    &amp; = \frac{1}{n^2}\text{Var}(\sum_{i=1}^{n} 
        \mathbb{I}_{[\tau_{i},\infty)}(t)) \\
    &amp; = \frac{1}{n^2}[\sum_{i=1}^{n} 
        \text{Var}(\mathbb{I}_{[\tau_{i},\infty)}(t)) +
        \sum_{i=1}^{n} \sum\limits_{\substack{j=1 \\ j
        \ne i}}^{n}\text{Cov}(\mathbb{I}_{[\tau_{i},
        \infty)}(t), \mathbb{I}_{[\tau_{j},\infty)}(t))] \\
    &amp; = \frac{1}{n^2}[\sum_{i=1}^{n} \Delta_{i,i} +
        \sum_{i=1}^{n} \sum\limits_{\substack{j=1 \\ j
        \ne i}}^{n}\Delta_{i,j}] \\
\end{split}
\]</span></p>
</div>
</div>
<div id="media-de-la-función-de-supervivencia" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Media de la función de supervivencia</h2>
<p>Buscamos construir un estimador del tiempo de sobrevida de los pacientes al proponer la media de la función de supervivencia empírica como sigue:</p>
<p><span class="math display">\[
\begin{split}
\mu 
    &amp; = \mathbf{E}(\nu) \\
    &amp; = \sum_{i=1}^n \nu_{i} \cdot \mathbb{P}(\nu = \nu_{i})\\
    &amp; = \sum_{i=1}^n \nu_{i} \cdot [F(\nu_{i}) -
        \lim_{y \rightarrow \nu_{i}^-} F(y)]\\
\end{split}
\]</span></p>
</div>
</div>
<div id="análisis-gráfico-y-simulaciones" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Análisis gráfico y simulaciones</h1>
<div id="ambiente-de-r" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Ambiente de R</h2>
<p>Para el presente proyecto se utilizaron las librerías que se muestran a continuación:</p>
<ul>
<li><code>ggplot2</code> -&gt; graficar.</li>
<li><code>tidyverse</code> -&gt; manejar los datos.</li>
<li><code>kableExtra</code> -&gt; diseño de las tablas.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code></pre></div>
</div>
<div id="población" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Población</h2>
<p>A continuación vamos a generar el tiempo que se tiene registrado de los pacientes (inicialmente sin importar si es el tiempo de fallecimiento o si dejaron de contestar) siguiendo una distribución normal con media <span class="math inline">\(\mu=50\)</span> y desviación estándar <span class="math inline">\(\sigma=20\)</span>.</p>
<p>Se va a generar una población de <span class="math inline">\(N=100\)</span> personas, se fijará la semilla de los aleatorio en <span class="math inline">\(\text{Seed} = 1\)</span> para hacer un ejemplo reproducible, se tomará el valor absoluto de los tiempos generados y se truncará el decimal al entero próximo.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>persona <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>N</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>tiempo <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">50</span>, <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">abs</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ceiling</span>()</span></code></pre></div>
<p>Ahora vamos a determinar cuales de ellos dejaron de contestar, recordemos que los cuidadores tienen una probabilidad <span class="math inline">\(p\in[0,1)\)</span> de dejar de contestar el teléfono. Para eso vamos a suponer que cada uno de ellos se distribuye <span class="math inline">\(\text{Bernoulli}(p)\)</span>, por lo que para generar cada uno de ellos vamos a utilizar la distribución <span class="math inline">\(\text{Binomial(N,p)}\)</span>. Con fines de verificar que tanto cambian nuestro estimadores con cada probabilidad utilizaremos distintos valores de <span class="math inline">\(p\in\{0,.25,.50,.75\}\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>p_0 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>p_25 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,.<span class="dv">25</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>p_50 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,.<span class="dv">50</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>p_75 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="dv">1</span>,.<span class="dv">75</span>)</span></code></pre></div>
<p>De esta manera podemos determinar que si el número generado por cada una de las <span class="math inline">\(\text{Bernoulli}\)</span> es <span class="math inline">\(1\)</span> entonces dejó de contestar y si es <span class="math inline">\(0\)</span> entonces tenemos la información actualizada.</p>
<p>Vamos a incluir el tiempo y cada una de las indicadoras en una sola tabla para facilitar el análisis.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pacientes_pob <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(persona, tiempo, p_0, p_25, p_50, p_75)</span></code></pre></div>
<p>Veamos como se ven los primeros 20 registro de nuestra tabla:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pacientes_pob, <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
persona
</th>
<th style="text-align:right;">
tiempo
</th>
<th style="text-align:right;">
p_0
</th>
<th style="text-align:right;">
p_25
</th>
<th style="text-align:right;">
p_50
</th>
<th style="text-align:right;">
p_75
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
54
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
57
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
65
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
58
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
73
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>Calculemos el tiempo de sobrevida de nuestra población para los dos casos:</p>
<ul>
<li>Solamente tomar en cuenta aquellos de los que se tiene registro completo.</li>
<li>Tomar en cuenta a toda la población.</li>
</ul>
<div id="registro-completo" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Registro completo</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>medias_com_pob <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    temp <span class="ot">&lt;-</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        pacientes_pob <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(persona,tiempo, i) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter_at</span>(<span class="dv">3</span>, <span class="fu">all_vars</span>(.<span class="sc">==</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.vector</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    medias_com_pob <span class="ot">&lt;-</span><span class="fu">append</span>(medias_com_pob, temp)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(medias_com_pob) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;p=0&quot;</span>,<span class="st">&quot;p=.25&quot;</span>,<span class="st">&quot;p=.50&quot;</span>, <span class="st">&quot;p=.75&quot;</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>medias_com_pob <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
x
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
p=0
</td>
<td style="text-align:right;">
52.66000
</td>
</tr>
<tr>
<td style="text-align:left;">
p=.25
</td>
<td style="text-align:right;">
51.54321
</td>
</tr>
<tr>
<td style="text-align:left;">
p=.50
</td>
<td style="text-align:right;">
52.59649
</td>
</tr>
<tr>
<td style="text-align:left;">
p=.75
</td>
<td style="text-align:right;">
50.61538
</td>
</tr>
</tbody>
</table>
</div>
<div id="toda-la-población" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Toda la población</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    pacientes_pob <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(tiempo) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.vector</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>medias_todo_pob <span class="ot">&lt;-</span> <span class="fu">rep</span>(temp,<span class="dv">4</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(medias_todo_pob) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;p=0&quot;</span>,<span class="st">&quot;p=.25&quot;</span>,<span class="st">&quot;p=.50&quot;</span>, <span class="st">&quot;p=.75&quot;</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>medias_todo_pob <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
x
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
p=0
</td>
<td style="text-align:right;">
52.66
</td>
</tr>
<tr>
<td style="text-align:left;">
p=.25
</td>
<td style="text-align:right;">
52.66
</td>
</tr>
<tr>
<td style="text-align:left;">
p=.50
</td>
<td style="text-align:right;">
52.66
</td>
</tr>
<tr>
<td style="text-align:left;">
p=.75
</td>
<td style="text-align:right;">
52.66
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="muestra" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Muestra</h2>
<p>A continuación vamos a obtener la muestra mediante <em>Muestreo Aleatorio Simple sin reemplazo</em> de <span class="math inline">\(50\)</span> pacientes para poner a prueba nuestros estimadores.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pacientes_mues <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(pacientes_pob,n, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
    </section>
  </div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
