mes <- 1
año <- 2020
victimas %>%
group_by(year(FechaInicio),month(FechaInicio), Categoria) %>%
tally() %>%
rename(año = 'year(FechaInicio)', mes = 'month(FechaInicio)') %>%
mutate(fecha = dmy(paste0("01","-",mes,"-",año)))
victimas %>%
group_by(year(FechaInicio),month(FechaInicio), Categoria) %>%
tally() %>%
rename(año = 'year(FechaInicio)', mes = 'month(FechaInicio)') %>%
mutate(fecha = dmy(paste0("01","-",mes,"-",año))) %>%
ggplot() +
geom_line(aes(x = fecha, y = n)) +
theme(legend.position = "left")
line<-
victimas %>%
group_by(Categoria, FechaInicio) %>%
tally() %>%
ggplot() +
geom_line(aes(x = FechaInicio, y = n, color=Categoria)) +
theme(legend.position = "left") +
ggplotly(line)
line<-
victimas %>%
group_by(Categoria, FechaInicio) %>%
tally() %>%
ggplot() +
geom_line(aes(x = FechaInicio, y = n, color=Categoria)) +
theme(legend.position = "left")
ggplotly(line)
?ggplotly
ggplotly(line, dynamicTicks = TRUE)
a <- victimas$FechaHecho[1]
a
victimas$HoraHecho[1]
line<-
victimas %>%
mutate(FechaInicioHora = ymd_hms(paste(FechaInicio, HoraInicio)))
line
line$FechaInicioHora
line<-
victimas %>%
mutate(FechaInicioHora =
ymd_hms(paste(FechaInicio, HoraInicio))) %>%
group_by(Categoria, FechaInicioHora) %>%
tally() %>%
ggplot() +
geom_line(aes(x = FechaInicioHora, y = n, color=Categoria)) +
theme(legend.position = "left") +
labs(title = "Delitos a través del tiempo",
x = "fecha",
y = "cantidad de delitos")
line
ggplotly(line, dynamicTicks = TRUE)
line<-
victimas %>%
mutate(FechaInicioHora =
ymd_hms(paste(FechaInicio, HoraInicio))) %>%
group_by(Categoria, FechaInicioHora) %>%
tally()
View(line)
line<-
victimas %>%
mutate(FechaInicioHora =
ymd_hms(paste(FechaInicio, HoraInicio))) %>%
group_by(Categoria, FechaInicioHora) %>%
tally() %>%
ggplot() +
geom_line(aes(x = FechaInicioHora, y = n, color=Categoria)) +
theme(legend.position = "right") +
labs(title = "Delitos a través del tiempo",
x = "fecha",
y = "cantidad de delitos")
ggplotly(line, dynamicTicks = TRUE)
line<-
victimas %>%
mutate(FechaInicioHora =
ymd_hms(paste(FechaInicio, HoraInicio))) %>%
group_by(Categoria, FechaInicioHora) %>%
tally() %>%
ggplot() +
geom_line(aes(x = FechaInicioHora, y = n, color=Categoria)) +
theme(legend.position = "left") +
labs(title = "Delitos a través del tiempo",
x = "fecha",
y = "cantidad de delitos")
ggplotly(line, dynamicTicks = TRUE)
line<-
victimas %>%
group_by(Categoria, FechaInicio) %>%
tally() %>%
ggplot() +
geom_line(aes(x = FechaInicio, y = n, color=Categoria)) +
theme(legend.position = "left") +
labs(title = "Delitos a través del tiempo",
x = "fecha",
y = "cantidad de delitos")
ggplotly(line, dynamicTicks = TRUE)
pie4 <-
victimas %>%
select(Sexo) %>%
group_by(Sexo) %>%
tally() %>%
na.omit() %>%
plot_ly(labels = ~Sexo, values = ~n, type = 'pie') %>%
layout(title = "Proporción del sexo de las víctimas")
pie4
pie1 <-
victimas %>%
select(CalidadJuridica) %>%
group_by(CalidadJuridica) %>%
tally() %>%
na.omit() %>%
plot_ly(labels = ~CalidadJuridica, values = ~n, type = 'pie') %>%
layout(title = "Proporción de la calidad jurídica de las personas")
pie1
pie2 <-
victimas %>%
select(competencia) %>%
group_by(competencia) %>%
tally() %>%
na.omit() %>%
plot_ly(labels = ~competencia, values = ~n, type = 'pie') %>%
layout(title = "Proporción de la competencia que procesa el delito")
pie2
pie3 <-
victimas %>%
select(TipoPersona) %>%
group_by(TipoPersona) %>%
tally() %>%
na.omit() %>%
plot_ly(labels = ~TipoPersona, values = ~n, type = 'pie') %>%
layout(title = "Proporción del tipo de persona")
pie3
pie4 <-
victimas %>%
select(Sexo) %>%
group_by(Sexo) %>%
tally() %>%
na.omit() %>%
plot_ly(labels = ~Sexo, values = ~n, type = 'pie') %>%
layout(title = "Proporción del sexo de las víctimas")
pie4
?plot_ly
scat <-
victimas %>%
mutate(inicio_vs_hecho = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
filter(Edad<150, Edad>0, Categoria == "VIOLACIÓN",
!is.na(Sexo)) %>%
ggplot() +
geom_point(aes(x=Edad, y=inicio_vs_hecho, color = Sexo)) +
labs(title = "Días desde el hecho a la denuncia por edad",
subtitle = 'Fecha: {frame_time}',
x = "edad",
y = "días desde que ocurre el hecho hasta que se denuncia") +
ylim(0,1000) +
transition_time(FechaInicio) +
ease_aes('linear')
animate(scat, duration = 40)
?ggplotly
scale_x_discrete(labels=
substr(unique(sort(victimas$categoría)),0,20))
ggplot() +
geom_bar(aes(x=categoría, y=tiempo, fill = categoría),
stat = "identity") +
coord_flip() +
theme(legend.position = "none")+
labs(title = "",
x = "tiempo entre el hecho y la denuncia") +
scale_x_discrete(labels=
substr(unique(sort(victimas$categoría)),0,20))
bar <-
victimas %>%
mutate(inicio_vs_hecho = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(inicio_vs_hecho = mean(inicio_vs_hecho,
na.rm = TRUE)) %>%
arrange(Categoria) %>%
rename(tiempo=inicio_vs_hecho, categoría=Categoria) %>%
ggplot() +
geom_bar(aes(x=categoría, y=tiempo, fill = categoría),
stat = "identity") +
coord_flip() +
theme(legend.position = "none")+
labs(title = "",
x = "tiempo entre el hecho y la denuncia") +
scale_x_discrete(labels=
substr(unique(sort(victimas$categoría)),0,20))
ggplotly(bar, tooltip = c("categoría", tiempo))
ggplotly(bar, tooltip = c("categoría", "tiempo"))
bar
bar <-
victimas %>%
mutate(inicio_vs_hecho = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(inicio_vs_hecho = mean(inicio_vs_hecho,
na.rm = TRUE)) %>%
arrange(Categoria) %>%
rename(tiempo=inicio_vs_hecho, categoría=Categoria) %>%
ggplot() +
geom_bar(aes(x=categoría, y=tiempo, fill = categoría),
stat = "identity") +
coord_flip() +
theme(legend.position = "none")+
labs(title = "",
x = "tiempo entre el hecho y la denuncia") +
scale_x_discrete(labels=
substr(unique(sort(victimas$categoría)),0,20))
ggplotly(bar, tooltip = c("categoría", "tiempo"))
bar <-
victimas %>%
mutate(inicio_vs_hecho = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(inicio_vs_hecho = mean(inicio_vs_hecho,
na.rm = TRUE)) %>%
arrange(Categoria) %>%
rename(tiempo=inicio_vs_hecho, categoría=Categoria) %>%
ggplot() +
geom_bar(aes(x=categoría, y=tiempo, fill = categoría),
stat = "identity") +
coord_flip() +
theme(legend.position = "none") +
scale_x_discrete(labels=
substr(unique(sort(victimas$categoría)),0,20))
ggplotly(bar, tooltip = c("categoría", "tiempo"))
substr(unique(sort(victimas$categoría)),0,20)
substr(unique(sort(victimas$Categoria)),0,20)
bar <-
victimas %>%
mutate(inicio_vs_hecho = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(inicio_vs_hecho = mean(inicio_vs_hecho,
na.rm = TRUE)) %>%
arrange(Categoria) %>%
rename(tiempo=inicio_vs_hecho, categoría=Categoria)
bar
bar
bar <-
victimas %>%
mutate(inicio_vs_hecho = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(inicio_vs_hecho = mean(inicio_vs_hecho,
na.rm = TRUE)) %>%
arrange(Categoria) %>%
ggplot() +
geom_bar(aes(x=Categoria, y=inicio_vs_hecho, fill = Categoria),
stat = "identity") +
coord_flip() +
theme(legend.position = "none")+
scale_x_discrete(labels=
substr(unique(sort(victimas$Categoria)),0,20))
ggplotly(bar, tooltip = c("categoría", "tiempo"))
bar <-
victimas %>%
mutate(tiempo = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(tiempo = mean(inicio_vs_hecho,
na.rm = TRUE)) %>%
arrange(Categoria) %>%
ggplot() +
geom_bar(aes(x=Categoria, y=tiempo, fill = Categoria),
stat = "identity") +
coord_flip() +
theme(legend.position = "none")+
scale_x_discrete(labels=
substr(unique(sort(victimas$Categoria)),0,20))
ggplotly(bar, tooltip = c("tiempo"))
bar <-
victimas %>%
mutate(tiempo = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(tiempo = mean(inicio_vs_hecho,
na.rm = TRUE)) %>%
arrange(Categoria) %>%
ggplot() +
geom_bar(aes(x=Categoria, y=tiempo, fill = Categoria),
stat = "identity") +
coord_flip() +
labs(title = "Promedio del tiempo entre hecho y denuncia por tipo de delito",
x = "tipo de delito",
y = "tiempo promedio entre el delito y la denuncia") +
theme(legend.position = "right")+
scale_x_discrete(labels=
substr(unique(sort(victimas$Categoria)),0,20))
bar <-
victimas %>%
mutate(tiempo = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(tiempo = mean(tiempo, na.rm = TRUE)) %>%
arrange(Categoria) %>%
ggplot() +
geom_bar(aes(x=Categoria, y=tiempo, fill = Categoria),
stat = "identity") +
coord_flip() +
labs(title = "Promedio del tiempo entre hecho y denuncia por tipo de delito",
x = "tipo de delito",
y = "tiempo promedio entre el delito y la denuncia") +
theme(legend.position = "right")+
scale_x_discrete(labels=
substr(unique(sort(victimas$Categoria)),0,20))
ggplotly(bar, tooltip = c("tiempo"))
bar_data <-
victimas %>%
mutate(tiempo = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(tiempo = mean(tiempo, na.rm = TRUE)) %>%
arrange(Categoria)
View(bar_data)
bar_data %>% arrange(tiempo)
bar_data %>% arrange(desctiempo))
bar_data %>% arrange(desc(tiempo))
bar_data <-
victimas %>%
mutate(tiempo = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(tiempo = mean(tiempo, na.rm = TRUE)) %>%
arrange(Categoria)
bar <-
bar_data %>%
ggplot() +
geom_bar(aes(x=Categoria, y=tiempo, fill = Categoria),
stat = "identity") +
coord_flip() +
labs(title = "Promedio del tiempo entre hecho y denuncia por tipo de delito",
x = "tipo de delito",
y = "tiempo promedio entre el delito y la denuncia") +
theme(legend.position = "right")+
scale_x_discrete(labels=
substr(unique(sort(victimas$Categoria)),0,20))
ggplotly(bar, tooltip = c("tiempo"))
bar_data <-
victimas %>%
mutate(tiempo = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(tiempo = mean(tiempo, na.rm = TRUE)) %>%
arrange(Categoria)
bar <-
bar_data %>%
ggplot() +
geom_bar(aes(x=Categoria, y=tiempo, fill = Categoria),
stat = "identity") +
coord_flip() +
labs(title = "Promedio del tiempo entre hecho y denuncia por tipo de delito",
x = "tipo de delito",
y = "tiempo promedio entre el delito y la denuncia") +
theme(legend.position = "right")+
scale_x_discrete(labels=
substr(unique(sort(victimas$Categoria)),0,20))
ggplotly(bar, tooltip = c("tiempo"))
bar_data <-
victimas %>%
mutate(tiempo = difftime(FechaInicio, FechaHecho,
units = "days")) %>%
group_by(Categoria) %>%
summarise(tiempo = mean(tiempo, na.rm = TRUE)) %>%
arrange(Categoria)
bar <-
bar_data %>%
ggplot() +
geom_bar(aes(x=Categoria, y=tiempo, fill = Categoria),
stat = "identity") +
coord_flip() +
labs(title = "Promedio del tiempo entre hecho y denuncia por tipo de delito",
x = "tipo de delito",
y = "tiempo promedio entre el delito y la denuncia") +
theme(legend.position = "right")+
scale_x_discrete(labels=
substr(unique(sort(victimas$Categoria)),0,20))
ggplotly(bar, tooltip = c("tiempo"))
knitr::opts_chunk$set(echo = TRUE, warning = FALSE,
message = FALSE, fig.align = "center")
library(plotly)
library(tidyverse)
library(lubridate)
library(openxlsx)
library(kableExtra)
library(sf)
library(moments)
library(gganimate)
library(wordcloud2)
data_url <- "https://archivo.datos.cdmx.gob.mx/fiscalia-general-de-justicia/victimas-en-carpetas-de-investigacion-fgj/victimas_completa_julio_2021.csv"
victimas <- read_csv(data_url, show_col_types = FALSE)
dicc_url <- "https://datos.cdmx.gob.mx/dataset/7593b324-6010-44f7-8132-cb8b2276c842/resource/10235569-f4a9-4876-9465-9780887df8e2/download/diccionario-de-victimas-actualizado.xlsx"
diccionario <- read.xlsx(dicc_url, sheet =1)
victimas$Mes_inicio <- as.factor(victimas$Mes_inicio)
victimas$FechaInicio <- dmy(victimas$FechaInicio)
victimas$Delito <- as.factor(victimas$Delito)
victimas$Categoria <- as.factor(victimas$Categoria)
victimas$Sexo <- as.factor(victimas$Sexo)
victimas$TipoPersona <- as.factor(victimas$TipoPersona)
victimas$CalidadJuridica <- as.factor(victimas$CalidadJuridica)
victimas$competencia <- as.factor(victimas$competencia)
victimas$Mes_hecho <- as.factor(victimas$Mes_hecho)
victimas$FechaHecho <- dmy(victimas$FechaHecho)
victimas$AlcaldiaHechos <- as.factor(victimas$AlcaldiaHechos)
diccionario[,1:2] %>%
kable()
victimas %>%
select(Año_inicio, Sexo, Edad) %>%
rename('Año inicio'=Año_inicio) %>%
filter(!is.na(Edad), !is.na(Sexo), Edad>0, Edad<150) %>%
group_by(`Año inicio`, Sexo) %>%
summarise(Media = round(mean(Edad),2),
SD = round(sd(Edad),2),
Mediana = median(Edad),
Asimetría = round(skewness(Edad),2),
Curtosis = round(kurtosis(Edad),2),
IQR = IQR(Edad),
Mínimo = min(Edad),
Máximo = max(Edad)) %>%
kable()
cloud <-
victimas %>%
select(Delito) %>%
group_by(Delito) %>%
tally() %>%
na.omit() %>%
wordcloud2(size=5, color='random-dark',
backgroundColor="white", shape = "circle")
cloud
if (!dir.exists("datos_mapa")) {
map_url <- "https://github.com/prestevez/covid-19-mx-map/raw/master/datos_covid/01_32_mun.zip"
download.file(map_url, destfile = "datos_mapa.zip")
unzip("datos_mapa.zip", exdir = "datos_mapa")
file.remove("datos_mapa.zip")
}
mex_map <-
st_read("datos_mapa/01_32_mun.shp", quiet = TRUE) %>%
st_set_crs("+proj=lcc +lat_1=17.5 +lat_2=29.5 +lat_0=12 +lon_0=-102 +x_0=2500000 +y_0=0 +ellps=GRS80 +units=m +no_defs") %>%
filter(CVE_ENT == "09") %>%
rename(Alcaldia = NOMGEO)
mex_map$Alcaldia <- chartr("ÁÉÍÓÚ", "AEIOU",
toupper(mex_map$Alcaldia))
map_filt <-
victimas %>%
select(AlcaldiaHechos) %>%
group_by(AlcaldiaHechos) %>%
tally(name = "Delitos") %>%
na.omit() %>%
arrange(desc(Delitos))
map_filt$AlcaldiaHechos <-
str_replace(map_filt$AlcaldiaHechos,
"GUSTAVO A MADERO", "GUSTAVO A. MADERO")
mex_map_del <-
left_join(mex_map, map_filt,
by = c("Alcaldia" = "AlcaldiaHechos")) %>%
rename(Alcaldía = Alcaldia)
rm(mex_map)
map <-
ggplot() +
geom_sf(data = mex_map_del,
aes(fill = Delitos, shape = Alcaldía),
colour = "grey75", size = 0.1) +
labs(title = "Cantidad de delitos por alcaldía en la CDMX",
x = "longitud",
y = "latitud") +
theme_bw() +
scale_fill_gradient("Total de delitos",
high = "red", low = "yellow") +
theme(legend.position = "none")
ggplotly(map, tooltip = c("Delitos","Alcaldía"))
loli_data <-
data.frame(día = as.character(wday(victimas$FechaHecho,
label = TRUE, abbr = FALSE))) %>%
group_by(día) %>%
tally() %>%
na.omit() %>%
rename(delitos = n)
loli <-
loli_data %>%
ggplot(aes(x=día, y=delitos)) +
geom_segment(aes(xend=día, yend=0)) +
geom_point(size=4, color= "#189c54") +
theme_bw() +
labs(title = "Total de delitos por día de la semana",
x = "día de la semana",
y = "total de delitos")
ggplotly(loli)
ggplotly(loli)
```
install.packages(c("htmlwidgets", "knitr", "rmarkdown"))
install.packages(c("htmlwidgets", "knitr", "rmarkdown"))
?ggplotly
knitr::opts_chunk$set(echo = TRUE, warning = FALSE,
message = FALSE, fig.align = "center")
library(plotly)
library(tidyverse)
library(lubridate)
library(openxlsx)
library(kableExtra)
library(sf)
library(moments)
library(gganimate)
library(wordcloud2)
data_url <- "https://archivo.datos.cdmx.gob.mx/fiscalia-general-de-justicia/victimas-en-carpetas-de-investigacion-fgj/victimas_completa_julio_2021.csv"
victimas <- read_csv(data_url, show_col_types = FALSE)
install.packages("plotly")
install.packages("plotly")
library(htmlwidgets)
